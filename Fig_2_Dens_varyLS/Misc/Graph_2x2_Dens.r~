datname = 'Fig2'
filedatname <- paste("Data/",datname,sep="")
parmat = read.table(file = filedatname, header = T)

XValName = 'tv'
YValName = 'AvgVfrac'
FValName = 'tb'
ZValName = 'd'

XVals = unique(parmat[,XValName])
FVals = unique(parmat[,FValName])
ZVals = unique(parmat[,ZValName])
ZVals = ZVals


nXVals = length(XVals)
nFVals = length(FVals)
nZVals = length(ZVals)

#cols = c('blue', 'green', 'red', 'black')
initcols = c('blue', 'orange')
cols = colorRampPalette(c('blue', 'orange'))(length(FVals))

source('Tools/Functions.r', local = T)

png(file = 'Fig_2_Dens.png', units = 'in', width = 4, height = 4, res = 400)
layout(matrix(c(1,2,
                3,4), nrow = 2, byrow = T), widths = c(0.4,0.4,0.0),
       heights = c(0.25,0.25,0.25,0.25))
    par(oma = c(0,2,0,0.5), mar = c(3, 1.5, 1.5, 0))
for(i.f in 1:nFVals){
    FVal = FVals[i.f]
    plot.mat = matrix(nrow = nXVals, ncol = nZVals)
    for(i.z in 1:nZVals){
        wi <- parmat[,ZValName] == ZVals[i.z] & parmat[,FValName] == FVals[i.f]
        plot.mat[,i.z] = parmat[wi,YValName]
    }
    matplot(NA, type = 'l', xlim = c(0,365), ylim = c(0.0,1),
            xaxt = 'n', yaxt = 'n', xlab = '', ylab = '')
    polygon(x = c(0.0, FVal, FVal, 0.0), y = c(-2,-2,1,1), col = t_col('gray',70),
            lty = 3, lwd = 0.5)
    matlines(XVals, plot.mat, lwd = 1.5, lty = 1, col = cols)

###Axes
    yticks = c(0,0.25,0.5,0.75,1)
    if(i.f %in% c(1,3)){
        axis(side = 2, labels = yticks,
             at = yticks, padj = 0.5, cex.axis = 0.7)
mtext(side = 2, text = 'Average Seroprevalence', line = 2.25, outer = FALSE, cex = 0.7)

    }else{
        axis(side = 2, labels = FALSE, at = yticks,
             padj = 0.5)
    }


    xticks = round(seq(0,365, by = 30.4))
    labticks = c(1, NA,NA,NA,120,NA,NA,NA,240,NA,NA,NA,NA)
    labticks = c(1, NA,NA,4,NA,NA,NA,8,NA,NA,NA,12,NA)
###Axis labels
    if(i.f %in% c(1,2)){
        axis(side = 1, labels = FALSE, at = xticks)
    }
    if(i.f %in% c(1,2,3,4)){
        mtext(side = 1, text = 'Time of Vaccination', line = 1.25, cex = 0.7)
        axis(side = 1, labels = labticks, at = xticks, padj = -1.25, cex.axis = 0.7)
    }

    if(i.f==1){
##        polygon(x = c(35,35,200,200), y = c(0,0.55,0.55,0), lwd = 1,
##                col = 'white')
##        text(x = 0.3*365, y = 0.45, labels = bquote(underline("Lifespan")),
##             cex = 0.7)
        legendtext = rev(c('1 Yr', '2.5 Yrs', '5 Yrs', '10 Yrs'))
##        legend(x = 0.07*365, y = 0.5, legend = legendtext, col = rev(cols),
##               lwd = 2, bty = 'n', cex = 0.7)
        legend(x = 0.07*365, y = 0.7, legend = legendtext, col = rev(cols),
               lwd = 2, bty = 'n', cex = 0.7,
               title = as.expression(bquote(underline('Lifespan'))))

    }

##    polygon(x = c(-100,-100,400,400), y = c(1.1,1.245,1.245,1.1), lwd = 1,
##            col = 'white')
    mtext(side = 3, text =  paste('Breeding season: ', FVal, ' days',sep=''),
          cex = 0.7)
}
dev.off()
